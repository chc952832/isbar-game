import{d as D,r,l as $,c as i,a as e,b as x,t as c,F as f,g as h,w as M,p as R,q as w,j as E,T as L,e as S,k as T,o as u,_ as B}from"./index-cJkiJbtB.js";const F={class:"leaderboard-container"},N={class:"board-section"},V={class:"score-list"},j={class:"rank"},q={class:"name"},I={class:"score"},Y={class:"time"},z={class:"board-section"},G={class:"score-list"},H={class:"rank"},J={class:"name"},K={class:"score"},O={class:"time"},P={class:"board-section"},Q={class:"score-list"},U={class:"rank"},W={class:"name"},X={class:"score"},Z=D({__name:"Leaderboard",setup(ss){const p=r([]),m=r([]),y=r([]),k=r([]),b=r([]),_=r(!1),v=r(!1);function g(l){if(!l)return"";const s=l.toDate();return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()}`}function C(l){const s=[...l].sort((a,o)=>o.score-a.score),d=[];let t=1,n=null;return s.forEach((a,o)=>{a.score!==n&&(t=o+1),d.push({rank:t,entry:a}),n=a.score}),d}async function A(){const l=await w(E(T,"classify_scores")),s=[];l.forEach(a=>{const o=a.data();s.push({name:o.name,score:o.score,timestamp:o.timestamp instanceof L?o.timestamp:void 0})}),p.value=C(s),y.value=p.value.slice(0,5);const d=await w(E(T,"choice_scores")),t=[];d.forEach(a=>{const o=a.data();t.push({name:o.name,score:o.score,timestamp:o.timestamp instanceof L?o.timestamp:void 0})}),m.value=C(t),k.value=m.value.slice(0,5);const n=new Map;p.value.forEach(a=>n.set(a.entry.name,a.entry.score)),m.value.forEach(a=>{n.set(a.entry.name,(n.get(a.entry.name)||0)+a.entry.score)}),b.value=Array.from(n.entries()).map(([a,o])=>({name:a,total:o})).sort((a,o)=>o.total-a.total).slice(0,5)}return $(A),(l,s)=>{const d=R("RouterLink");return u(),i("div",F,[s[6]||(s[6]=e("h2",{class:"title"},"🏆 排行榜",-1)),e("div",N,[s[2]||(s[2]=e("h3",{class:"section-title"},"選擇遊戲",-1)),e("button",{onClick:s[0]||(s[0]=t=>v.value=!v.value),class:"toggle-all"},c(v.value?"顯示前五名":"查看全部紀錄"),1),e("ul",V,[(u(!0),i(f,null,h(v.value?m.value:k.value,(t,n)=>(u(),i("li",{key:n,class:"score-item"},[e("span",j,c(t.rank),1),e("span",q,c(t.entry.name),1),e("span",I,c(t.entry.score)+" 分",1),e("span",Y,c(g(t.entry.timestamp)),1)]))),128))])]),e("div",z,[s[3]||(s[3]=e("h3",{class:"section-title"},"分類遊戲",-1)),e("button",{onClick:s[1]||(s[1]=t=>_.value=!_.value),class:"toggle-all"},c(_.value?"顯示前五名":"查看全部紀錄"),1),e("ul",G,[(u(!0),i(f,null,h(_.value?p.value:y.value,(t,n)=>(u(),i("li",{key:n,class:"score-item"},[e("span",H,c(t.rank),1),e("span",J,c(t.entry.name),1),e("span",K,c(t.entry.score)+" 分",1),e("span",O,c(g(t.entry.timestamp)),1)]))),128))])]),e("div",P,[s[4]||(s[4]=e("h3",{class:"section-title"},"綜合排行榜",-1)),e("ul",Q,[(u(!0),i(f,null,h(b.value,(t,n)=>(u(),i("li",{key:n,class:"score-item"},[e("span",U,c(n+1),1),e("span",W,c(t.name),1),e("span",X,c(t.total)+" 分",1)]))),128))])]),x(d,{to:"/isbar-game/",class:"home-button"},{default:M(()=>s[5]||(s[5]=[S("🏠 回首頁")])),_:1,__:[5]})])}}}),ts=B(Z,[["__scopeId","data-v-e44630d8"]]);export{ts as default};
